openapi: 3.0.3
info:
  title: Transaction pull integration
  version: 2.5.0
  description: Financial Institutions provide transaction data in pull mode
  x-icon: local_atm
  x-deprecated: false
  x-api-dashboard-tags:
    - name: Retail
    - name: Business
servers:
  - description: Prism mock server
    url: 'http://localhost:4010'
tags:
  - name: transaction-integration-pull
paths:
  /service-api/v2/transactions/filter:
    post:
      summary: Retrieve latest transactions
      description: Retrieves the latest transactions from the Core system for a given set of arrangements and time range
      operationId: postFilter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FilterPostRequestBody'
      responses:
        '200':
          description: If data is retrieved successfully even if no transactions are found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FilterResponse'
              examples:
                shopping:
                  summary: Transactions for buying food and shoes
                  value:
                    - id: transaction-id-1-pull-ingestion
                      arrangementId: transaction-pull-ingestion-1
                      reference: PULL-123456
                      description: Vegan Junk Food Bar
                      type: Cash
                      typeGroup: Payment
                      category: Food & Dining
                      bookingDate: '2020-05-16'
                      valueDate: '2020-05-17'
                      creditDebitIndicator: DBIT
                      transactionAmountCurrency:
                        amount: '10.29'
                        currencyCode: USD
                      instructedAmountCurrency:
                        amount: '13.38'
                        currencyCode: USD
                      currencyExchangeRate: 1.3
                      counterPartyName: Junk Food Bar
                      counterPartyAccountNumber: '2732'
                      counterPartyBIC: ING00000001
                      counterPartyCountry: NL
                      counterPartyBankName: ING
                      creditorId: '764532'
                      mandateReference: '6541235478'
                      billingStatus: BILLED
                      checkSerialNumber: 12345
                      sequenceNumber: '1234'
                      creationTime: '2028-05-17T09:00:50.12+02:00'
                      enrichmentIndicator: DO_ENRICHMENT
                      disputeStatus: UNDISPUTED
                      batchOrderId: BATCH124-9f-6gg7-4e
                      additions:
                        settlementDate: '2020-06-01'
                        additionalCharges: '183.56'
                        purpose: vacation
                        purposeCode: '1'
                        fees: '62'
                        feeReferenceId: FEE-01
                        ultimateDebtorName: John Doe
                        counterPartyAddress: 'Zuidplein 10, 1077 XV'
                        counterPartyCity: Amsterdam
                        debtorId: df8e1cac-e483-4ad1-87e6-e7a2da343421
                        ultimateDebtorId: e7a2da343421
                        ultimateCreditorId: df8e1cac
                        ultimateCreditorName: Julia Pence
                        debtorReference: '[{''name'':''CLEO V MONROE SR'',''role'':''PRIMARY''},{''name'':''LANIE Q PIERCE'',''role'':''JOINT''}]'
                        MMCCode: V
                    - id: transaction-id-2-pull-ingestion
                      arrangementId: transaction-pull-ingestion-1
                      reference: PULL-78910
                      description: Zalando NL
                      type: Credit/Debit Card
                      typeGroup: Payment
                      category: Personal Care
                      bookingDate: '2020-05-16'
                      valueDate: '2020-05-17'
                      creditDebitIndicator: DBIT
                      currencyExchangeRate: 1.3
                      counterPartyName: AF Chagal
                      transactionAmountCurrency:
                        amount: '110.50'
                        currencyCode: EUR
                      instructedAmountCurrency:
                        amount: '143.65'
                        currencyCode: USD
                      counterPartyAccountNumber: '2732'
                      counterPartyBIC: ING00000001
                      counterPartyCountry: NL
                      counterPartyBankName: ING
                      counterPartyCategoryCode: 1234
                      creditorId: '764532'
                      mandateReference: '6541235478'
                      billingStatus: BILLED
                      checkSerialNumber: 123987
                      creationTime: '2018-05-16T08:10:32.13+02:00'
                      additions:
                        settlementDate: '2020-06-01'
                        additionalCharges: '183.56'
                        purpose: vacation
                        purposeCode: '1'
                        fees: '62'
                        feeReferenceId: FEE-01
                        ultimateDebtorName: John Doe
                        counterPartyAddress: 'Zuidplein 10, 1077 XV'
                        counterPartyCity: Amsterdam
                        debtorId: df8e1cac-e483-4ad1-87e6-e7a2da343421
                        ultimateDebtorId: e7a2da343421
                        ultimateCreditorId: df8e1cac
                        ultimateCreditorName: Julia Pence
                        debtorReference: '[{''name'':''CLEO V MONROE SR'',''role'':''PRIMARY''},{''name'':''LANIE Q PIERCE'',''role'':''JOINT''}]'
                        MMCCode: V
                savings:
                  summary: Saving money for holidays
                  value:
                    - id: savings-pull-ingestion-1
                      arrangementId: savings-pull-ingestion-1
                      reference: SAVINGS-PULL-1
                      description: Savings for Summer holidays
                      type: Cash
                      typeGroup: Payment
                      category: Transfer
                      bookingDate: '2020-08-16'
                      valueDate: '2020-08-16'
                      creditDebitIndicator: DBIT
                      transactionAmountCurrency:
                        amount: '450.00'
                        currencyCode: EUR
                      counterPartyName: Holiday savings
                      counterPartyAccountNumber: 2892-2000
                      billingStatus: BILLED
                      sequenceNumber: '9000'
                      creationTime: '2020-06-01T09:01:50.52Z'
                      disputeStatus: PENDING
                      additions:
                        settlementDate: '2020-06-01'
                        additionalCharges: '183.56'
                        purpose: vacation
                        purposeCode: '1'
                        fees: '62'
                        feeReferenceId: FEE-01
                        ultimateDebtorName: John Doe
                        counterPartyAddress: 'Zuidplein 10, 1077 XV'
                        counterPartyCity: Amsterdam
                        debtorId: df8e1cac-e483-4ad1-87e6-e7a2da343421
                        ultimateDebtorId: e7a2da343421
                        ultimateCreditorId: df8e1cac
                        ultimateCreditorName: Julia Pence
                        debtorReference: '[{''name'':''CLEO V MONROE SR'',''role'':''PRIMARY''},{''name'':''LANIE Q PIERCE'',''role'':''JOINT''}]'
                        MMCCode: V
                    - id: savings-pull-ingestion-2
                      arrangementId: savings-pull-ingestion-2
                      reference: SAVINGS-PULL-1
                      description: Savings for Summer holidays
                      type: Cash
                      typeGroup: Payment
                      category: Transfer
                      bookingDate: '2020-08-16'
                      valueDate: '2020-08-16'
                      creditDebitIndicator: CRDT
                      counterPartyName: Holiday savings
                      transactionAmountCurrency:
                        amount: '450.00'
                        currencyCode: EUR
                      counterPartyAccountNumber: 2892-1000
                      billingStatus: BILLED
                      sequenceNumber: '9000'
                      creationTime: '2020-06-01T09:01:50.52Z'
                      additions:
                        settlementDate: '2020-06-01'
                        additionalCharges: '183.56'
                        purpose: vacation
                        purposeCode: '1'
                        fees: '62'
                        feeReferenceId: FEE-01
                        ultimateDebtorName: John Doe
                        counterPartyAddress: 'Zuidplein 10, 1077 XV'
                        counterPartyCity: Amsterdam
                        debtorId: df8e1cac-e483-4ad1-87e6-e7a2da343421
                        ultimateDebtorId: e7a2da343421
                        ultimateCreditorId: df8e1cac
                        ultimateCreditorName: Julia Pence
                        debtorReference: '[{''name'':''CLEO V MONROE SR'',''role'':''PRIMARY''},{''name'':''LANIE Q PIERCE'',''role'':''JOINT''}]'
                        MMCCode: V
                advancement:
                  summary: Getting cash advance from a loan
                  value:
                    - id: advancement-pull-ingestion-1
                      arrangementId: advancement-pull-ingestion-1
                      reference: ADVANCEMENT-PULL-1
                      description: Advancement to repair car windows
                      type: Cash
                      typeGroup: Payment
                      category: Transfer
                      bookingDate: '2020-09-24'
                      valueDate: '2020-09-24'
                      creditDebitIndicator: DBIT
                      transactionAmountCurrency:
                        amount: '200.00'
                        currencyCode: EUR
                      counterPartyName: Current account
                      counterPartyAccountNumber: 2892-1000
                      billingStatus: BILLED
                      sequenceNumber: '9001'
                      creationTime: '2016-05-16T09:01:50.52Z'
                      batchOrderId: BATCH64b4d-a99f-1c9df
                      additions:
                        settlementDate: '2020-06-01'
                        additionalCharges: '183.56'
                        purpose: vacation
                        purposeCode: '1'
                        fees: '62'
                        feeReferenceId: FEE-01
                        ultimateDebtorName: John Doe
                        counterPartyAddress: 'Zuidplein 10, 1077 XV'
                        counterPartyCity: Amsterdam
                        debtorId: df8e1cac-e483-4ad1-87e6-e7a2da343421
                        ultimateDebtorId: e7a2da343421
                        ultimateCreditorId: df8e1cac
                        ultimateCreditorName: Julia Pence
                        debtorReference: '[{''name'':''CLEO V MONROE SR'',''role'':''PRIMARY''},{''name'':''LANIE Q PIERCE'',''role'':''JOINT''}]'
                        MMCCode: V
                    - id: advancement-pull-ingestion-2
                      arrangementId: advancement-pull-ingestion-2
                      reference: ADVANCEMENT-PULL-1
                      description: Advancement to repair car windows
                      type: Cash
                      typeGroup: Payment
                      category: Transfer
                      bookingDate: '2020-09-24'
                      valueDate: '2020-09-24'
                      creditDebitIndicator: CRDT
                      counterPartyName: Current account
                      transactionAmountCurrency:
                        amount: '200.00'
                        currencyCode: EUR
                      counterPartyAccountNumber: 2892-3000
                      billingStatus: BILLED
                      sequenceNumber: '9001'
                      creationTime: '2016-05-16T09:01:50.52Z'
                      additions:
                        settlementDate: '2020-06-01'
                        additionalCharges: '183.56'
                        purpose: vacation
                        purposeCode: '1'
                        fees: '62'
                        feeReferenceId: FEE-01
                        ultimateDebtorName: John Doe
                        counterPartyAddress: 'Zuidplein 10, 1077 XV'
                        counterPartyCity: Amsterdam
                        debtorId: df8e1cac-e483-4ad1-87e6-e7a2da343421
                        ultimateDebtorId: e7a2da343421
                        ultimateCreditorId: df8e1cac
                        ultimateCreditorName: Julia Pence
                        debtorReference: '[{''name'':''CLEO V MONROE SR'',''role'':''PRIMARY''},{''name'':''LANIE Q PIERCE'',''role'':''JOINT''}]'
                        MMCCode: V
        '400':
          description: If one or more request parameters don't comply with the specification
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestError'
              example:
                message: Bad Request
                key: GENERAL_ERROR
                errors:
                  - message: 'Value Exceeded. Must be between {min} and {max}.'
                    key: common.api.shoesize
                    context:
                      max: '50'
                      min: '1'
        '500':
          description: If a runtime error occurs while processing the request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'
              example:
                message: Description of error
      tags:
        - transaction-integration-pull
components:
  schemas:
    FilterPostRequestBody:
      type: object
      additionalProperties: false
      properties:
        arrangementId:
          description: External arrangementId.
          type: string
          example: 8a8586e1842dc89801842e26e5fe0a76
        fromDatetime:
          description: Indicates the date-time from when the transactions will be requested from the external system (e.g. core).
          type: string
          format: date-time
      required:
        - arrangementId
        - fromDatetime

    FilterResponse:
      type: object
      additionalProperties: false
      properties:
        id:
          description: Unique identification for the transaction as used in the external system
          maxLength: 300
          type: string
        arrangementId:
          description: Reference to the instance of the product in the external system to which the transactions belongs.
          maxLength: 50
          type: string
        reference:
          description: A tag/label issued by the initiator of the transaction in order to be able to refer to the respective transaction
          maxLength: 36
          type: string
        description:
          maxLength: 280
          type: string
        typeGroup:
          description: 'Indicates the group of related transactions types (eg payments is the transaction group for transaction types like Bill payment , Wire, ACH etc)'
          maxLength: 36
          type: string
        type:
          description: 'Indicates the type of the transaction (eg Bill Payment , ATM , Wire , ACH etc).'
          maxLength: 36
          type: string
        category:
          description: Transaction category
          maxLength: 50
          type: string
        bookingDate:
          description: The date the amount is posted to the balance of an account from a book keeping perspective.
          type: string
          format: date
        valueDate:
          description: The date on which an amount posted to an account becomes interest bearing
          type: string
          format: date
        transactionAmountCurrency:
          $ref: '#/components/schemas/Currency'
        instructedAmountCurrency:
          $ref: '#/components/schemas/Currency'
        currencyExchangeRate:
          description: The exchange rate (between both account and transaction currency) that was used for the conversion. To be used if those currencies are not the same
          type: number
        counterPartyName:
          description: The name of the counterparty
          maxLength: 128
          type: string
        counterPartyAccountNumber:
          description: The account number of the counter party involved in the transaction
          maxLength: 36
          type: string
        counterPartyBIC:
          description: The BIC of the counterparty
          maxLength: 11
          type: string
        counterPartyCity:
          description: City of the counterparty
          maxLength: 35
          type: string
        counterPartyAddress:
          description: Address of the counterparty
          maxLength: 140
          type: string
        counterPartyCountry:
          description: ISO Country code
          maxLength: 2
          minLength: 2
          type: string
        counterPartyBankName:
          description: The bank name of the counterparty
          maxLength: 128
          type: string
        counterPartyCategoryCode:
          description: The ISO 18245 merchant category code for the transaction.
          type: integer
          format: int32
          minimum: 1
        creditorId:
          description: Id of the creditor (Only for SEPA DD)
          maxLength: 19
          type: string
        mandateReference:
          description: Mandate Reference (Only for SEPA DD)
          maxLength: 128
          type: string
        billingStatus:
          description: 'Indicates the status of the transaction (e.g. pending , posted)'
          maxLength: 8
          type: string
        checkSerialNumber:
          description: Serial number of the check. Each check has a different number for identification purposes.
          type: integer
          format: int64
        runningBalance:
          description: Indicates the balance of the account at that moment when the transaction was executed
          type: number
        sequenceNumber:
          maxLength: 20
          pattern: '(^[1-9][0-9]*)|0$'
          type: string
        creditDebitIndicator:
          enum:
            - CRDT
            - DBIT
          type: string
        creationTime:
          description: Indicates the creation time of the transaction
          type: string
          format: date-time
        checkImageAvailability:
          description: Indicates the state of check images for the transaction
          $ref: '#/components/schemas/CheckImageAvailability'
        enrichmentIndicator:
          $ref: '#/components/schemas/EnrichmentIndicator'
        disputeStatus:
          description: Indicates the dispute status of a transaction
          $ref: '#/components/schemas/DisputeStatus'
        batchOrderId:
          description: Transaction batch order ID from DBS batches
          maxLength: 50
          type: string
        additions:
          description: Additional properties
          type: object
          additionalProperties:
            type: string
      required:
        - arrangementId
        - bookingDate
        - creditDebitIndicator
        - description
        - id
        - transactionAmountCurrency
        - type
        - typeGroup
    CheckImageAvailability:
      type: string
      example: AVAILABLE
      enum:
        - AVAILABLE
        - UNAVAILABLE
    EnrichmentIndicator:
      type: string
      description: |
        Indicates whether transaction needs to be enriched or not by following logic.
        STANDARD_ENRICHMENT: Use default rules in service for enrichment
        DO_ENRICHMENT: Ignore any existing rules and enrich the transaction only if it's not enriched already
        FORCE_ENRICHMENT: Ignore any existing rules and enrich the transaction even if it's already enriched
        NO_ENRICHMENT: Ignore any existing rules and don't attempt to enrich the transaction
        CONFIGURED_ENRICHMENT: Use configured category in service for categorisation of the transaction
      example: DO_ENRICHMENT
      enum:
        - STANDARD_ENRICHMENT
        - DO_ENRICHMENT
        - FORCE_ENRICHMENT
        - NO_ENRICHMENT
        - CONFIGURED_ENRICHMENT
    DisputeStatus:
      enum:
        - UNDISPUTED
        - PENDING
        - REJECTED
        - REFUNDED
      type: string
      example: UNDISPUTED
    Currency:
      title: Currency
      type: object
      properties:
        amount:
          description: The amount in the specified currency
          type: string
          minimum: -1000000000000000000
          maximum: 1000000000000000000
        currencyCode:
          description: The alpha-3 code (complying with ISO 4217) of the currency that qualifies the amount
          type: string
          pattern: '^[A-Z]{3}$'
        additions:
          description: Additional properties
          type: object
          additionalProperties:
            type: string
      required:
        - amount
        - currencyCode
    ErrorItem:
      title: ErrorItem
      type: object
      properties:
        message:
          description: Any further information.
          type: string
          minLength: 1
        key:
          description: '{capability-name}.api.{api-key-name}. For generated validation errors this is the path in the document the error resolves to. e.g. object name + ''.'' + field'
          type: string
          minLength: 1
        context:
          title: Context
          description: Context can be anything used to construct localised messages.
          type: object
          additionalProperties:
            type: string
      required:
        - message
        - key
    BadRequestError:
      title: BadRequestError
      type: object
      required:
        - message
        - key
      properties:
        message:
          type: string
          description: Any further information
          minLength: 1
        key:
          type: string
          description: Error summary
          minLength: 1
        errors:
          type: array
          description: Detailed error information
          items:
            $ref: '#/components/schemas/ErrorItem'
    InternalServerError:
      title: InternalServerError
      type: object
      description: Represents HTTP 500 Internal Server Error
      properties:
        message:
          type: string
          description: Any further information
          minLength: 1
        key:
          type: string
          description: Error summary
          minLength: 1
